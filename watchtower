version: '3.8'
services:
  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    environment:
      TZ: "Asia/Shanghai"
      WATCHTOWER_NOTIFICATIONS: "shoutrrr"
      WATCHTOWER_NOTIFICATION_REPORT: "true"
      WATCHTOWER_NOTIFICATION_URL: "telegram://token@telegram/?chats=id"
      WATCHTOWER_NOTIFICATIONS_LEVEL: "info"
      WATCHTOWER_NOTIFICATION_TEMPLATE: |-
        {{- with .Report -}}
        📊 **容器更新报告**
        ---
        🔍 扫描总数：{{len .Scanned}}
        ✔️ 成功更新：{{len .Updated}}
        ⚠️ 跳过更新：{{len .Skipped}}
        ❌ 更新失败：{{len .Failed}}
        {{- if .Fresh }}
        🆕 **运行中容器：**
        {{- range .Fresh }}
        - {{.Name}} ({{.ImageName}})
        {{- end }}
        {{- end }}
        {{- end -}}
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command:
      - --schedule
      - "0 0 1 * * *"
      - --cleanup
      - --warn-on-head-failure=never
      - --include-restarting
      - --notify-report
    restart: unless-stopped
